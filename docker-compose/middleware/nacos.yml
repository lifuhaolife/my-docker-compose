version: '3.8'

services:
  nacos:
    image: nacos/nacos-server:v2.2.0
    container_name: nacos
    restart: unless-stopped
    environment:
      MODE: standalone
      PREFER_HOST_MODE: hostname
      NACOS_AUTH_ENABLE: ${NACOS_AUTH_ENABLE}
      NACOS_AUTH_TOKEN: ${NACOS_AUTH_TOKEN}
      NACOS_AUTH_IDENTITY_KEY: ${NACOS_AUTH_IDENTITY_KEY}
      NACOS_AUTH_IDENTITY_VALUE: ${NACOS_AUTH_IDENTITY_VALUE}
    ports:
      - "${NACOS_PORT:-8848}:8848"
      - "${NACOS_GRPC_PORT:-9848}:9848"
    networks:
      - nacos_network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8848/nacos/v1/ns/service/list?pageNo=1&pageSize=10"]
      interval: 30s
      timeout: 10s
      retries: 5

volumes:
  nacos_logs:
    driver: local

networks:
  nacos_network:
    driver: bridge
